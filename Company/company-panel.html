<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Company Panel</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="/style.css"/>
  <style>.stat-card{background:#f9fafc;border-radius:14px;padding:18px;box-shadow:0 8px 24px rgba(0,0,0,.05);text-align:center}.stat-card p{margin:0;color:#667}.stat-card h3{margin:.25rem 0 1rem;font-weight:700}.stat-card .btn{width:100%}</style>
</head>
<body class="bg-light p-3">
  <!-- Navbar -->
  <div id="navbar-container"></div>
  <script>
    fetch('/shared/common-navbar.html').then(r=>r.text()).then(h=>{
      const c=document.getElementById('navbar-container'); c.innerHTML=h;
      c.querySelectorAll('script').forEach(s=>{const n=document.createElement('script'); if(s.src)n.src=s.src; else n.textContent=s.textContent; document.body.appendChild(n);});
    });
  </script>

  <div class="container py-4">
    <h3 class="mb-4">Company Panel</h3>
    <div class="row g-3">
      <div class="col-md-3 col-6"><div class="stat-card"><p>Total Jobs</p><h3 id="jobCount">-</h3><a class="btn btn-sm btn-outline-primary" href="/Company/create-job.html">Go</a></div></div>
      <div class="col-md-3 col-6"><div class="stat-card"><p>Total Applications</p><h3 id="applicationCount">-</h3><a class="btn btn-sm btn-outline-primary" href="/Company/company-applications.html">Go</a></div></div>
      <div class="col-md-3 col-6"><div class="stat-card"><p>Total Seafarers</p><h3 id="seafarerCount">-</h3><a class="btn btn-sm btn-outline-primary" href="/Company/public-cv-browser.html">Go</a></div></div>
      <div class="col-md-3 col-6"><div class="stat-card"><p>Total Ships</p><h3 id="shipCount">-</h3><a class="btn btn-sm btn-outline-primary" href="/Company/company-ship-list.html">Go</a></div></div>
    </div>
  </div>

  <script type="module">
    if ((localStorage.getItem('role')||'').toLowerCase() !== 'company') location.href='/index.html';

    import { auth, db } from '/firebase-config.js';
    import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
    import { collection, getDocs } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

    onAuthStateChanged(auth, async user=>{
      if(!user) return location.href='/index.html';
      const uid=user.uid;
      const [jobs, apps, ships, seas] = await Promise.all([
        getDocs(collection(db, `companies/${uid}/jobPosts`)),
        getDocs(collection(db, `companies/${uid}/applications`)),
        getDocs(collection(db, `companies/${uid}/ships`)),
        getDocs(collection(db, 'seafarers'))
      ]);
      document.getElementById('jobCount').textContent = jobs.size;
      document.getElementById('applicationCount').textContent = apps.size;
      document.getElementById('shipCount').textContent = ships.size;
      document.getElementById('seafarerCount').textContent = seas.size;
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
