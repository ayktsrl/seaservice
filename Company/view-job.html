<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Job Details - Company</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="/style.css"/>
  <style>
    .box{background:#fff;border-radius:12px;padding:22px;box-shadow:0 8px 24px rgba(0,0,0,.06)}
  </style>
</head>
<body class="bg-light p-3">
  <!-- Navbar -->
  <div id="navbar-container"></div>
  <script>
    fetch('/common-navbar.html').then(r=>r.text()).then(h=>{
      const c=document.getElementById('navbar-container'); c.innerHTML=h;
      c.querySelectorAll('script').forEach(s=>{const n=document.createElement('script'); if(s.src)n.src=s.src; else n.textContent=s.textContent; document.body.appendChild(n);});
    });
  </script>

  <div class="container py-4">
    <div class="box">
      <h4 id="title" class="mb-3">Job Post Details</h4>
      <div id="details" class="mb-3">Loading...</div>
      <div class="d-flex gap-2">
        <a class="btn btn-secondary" href="/Company/company-dashboard.html">Back</a>
        <button class="btn btn-outline-primary" onclick="window.print()">Print</button>
      </div>
    </div>
  </div>

  <script type="module">
    if ((localStorage.getItem('role')||'').toLowerCase() !== 'company') location.href='/index.html';

    import { auth, db } from '/firebase-config.js';
    import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
    import { doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

    const params=new URLSearchParams(location.search); const jobId=params.get('id');
    const title=document.getElementById('title'); const details=document.getElementById('details');

    function fmtDate(v){ try{ if(v?.toDate) return v.toDate().toLocaleString(); if(v) return new Date(v).toLocaleString(); }catch{} return '-'; }

    onAuthStateChanged(auth, async user=>{
      if(!user) return location.href='/index.html';
      const ref=doc(db, `companies/${user.uid}/jobPosts`, jobId);
      const snap=await getDoc(ref);
      const job=snap.data();
      if(!job){ details.innerHTML=`<div class="text-danger">Job not found.</div>`; return; }
      title.textContent = `${job.position || 'Position'} â€¢ Details`;
      details.innerHTML=`
        <div class="row g-2">
          <div class="col-md-6"><b>Position:</b> ${job.position||'-'}</div>
          <div class="col-md-6"><b>Vessel:</b> ${job.vesselName||'-'} (${job.vesselType||'-'})</div>
          <div class="col-md-6"><b>Joining Date:</b> ${job.joiningDate||'-'}</div>
          <div class="col-md-6"><b>Duration:</b> ${job.duration||'-'}</div>
          <div class="col-md-6"><b>Location:</b> ${job.location||'-'}</div>
          <div class="col-md-6"><b>Status:</b> ${job.status||'-'}</div>
          <div class="col-12"><b>Notes:</b><br>${(job.notes||'-').replace(/\n/g,'<br>')}</div>
          <div class="col-12"><b>Created At:</b> ${fmtDate(job.createdAt)}</div>
        </div>`;
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
