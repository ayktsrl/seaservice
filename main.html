<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Main Panel - Seafarer Application</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .tab-content > div {
      display: none;
    }
    .tab-content > div.active {
      display: block;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Seafarer Panel</a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link active" href="#" onclick="showTab('personal')">Personal Details</a></li>
          <li class="nav-item"><a class="nav-link" href="#" onclick="showTab('sea')">Sea Service</a></li>
          <li class="nav-item"><a class="nav-link" href="#" onclick="showTab('skills')">Special Skills</a></li>
          <li class="nav-item"><a class="nav-link" href="#" onclick="showTab('experience')">Experience</a></li>
          <li class="nav-item"><a class="nav-link" href="#" onclick="showTab('certificates')">Certificates</a></li>
          <li class="nav-item"><a class="nav-link" href="#" onclick="showTab('flagbooks')">Flag Books</a></li>
          <li class="nav-item"><a class="nav-link" href="#" onclick="showTab('licenses')">Licenses</a></li>
          <li class="nav-item"><a class="nav-link" href="#" onclick="showTab('visas')">Visas</a></li>
          <li class="nav-item"><a class="nav-link" href="#" onclick="showTab('vaccinations')">Vaccinations</a></li>
          <li class="nav-item"><a class="nav-link" href="#" onclick="showTab('education')">Education</a></li>
          <li class="nav-item"><a class="nav-link" href="#" onclick="showTab('references')">References</a></li>
          <li class="nav-item"><a class="nav-link" href="#" onclick="showTab('finish')">Finish</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container mt-4 tab-content">
    <div id="personal" class="active">
  <h3>Personal Details</h3>
  <form id="personalForm" onsubmit="savePersonalDetails(event)">
    <div class="row mb-2">
      <div class="col-md-6">
        <label class="form-label">Full Name</label>
        <input type="text" class="form-control" id="fullName" required>
      </div>
      <div class="col-md-6">
        <label class="form-label">Date of Birth</label>
        <input type="date" class="form-control" id="dob" required>
      </div>
    </div>
    <div class="row mb-2">
      <div class="col-md-6">
        <label class="form-label">Nationality</label>
        <input type="text" class="form-control" id="nationality" required>
      </div>
      <div class="col-md-6">
        <label class="form-label">Place of Birth</label>
        <input type="text" class="form-control" id="birthPlace" required>
      </div>
    </div>
    <div class="row mb-2">
      <div class="col-md-6">
        <label class="form-label">Phone Number</label>
        <input type="text" class="form-control" id="phone" required>
      </div>
      <div class="col-md-6">
        <label class="form-label">Email</label>
        <input type="email" class="form-control" id="email" required>
      </div>
    </div>
    <div class="row mb-2">
      <div class="col-md-4">
        <label class="form-label">Passport No</label>
        <input type="text" class="form-control" id="passportNo">
      </div>
      <div class="col-md-4">
        <label class="form-label">Issue Date</label>
        <input type="date" class="form-control" id="passportIssue">
      </div>
      <div class="col-md-4">
        <label class="form-label">Expiry Date</label>
        <input type="date" class="form-control" id="passportExpiry">
      </div>
    </div>
    <div class="row mb-2">
      <div class="col-md-4">
        <label class="form-label">Seaman Book No</label>
        <input type="text" class="form-control" id="seamanBookNo">
      </div>
      <div class="col-md-4">
        <label class="form-label">Issue Date</label>
        <input type="date" class="form-control" id="seamanIssue">
      </div>
      <div class="col-md-4">
        <label class="form-label">Expiry Date</label>
        <input type="date" class="form-control" id="seamanExpiry">
      </div>
    </div>
    <div class="mb-3">
      <label class="form-label">Address</label>
      <textarea class="form-control" id="address" rows="2"></textarea>
    </div>
    <button type="submit" class="btn btn-primary">Save</button>
    <div id="saveMessage" class="text-success mt-2"></div>
  </form>
</div>

<div id="sea">
  <h3>Sea Service</h3>
  <form id="seaServiceForm" onsubmit="saveSeaService(event)">
    <div class="row mb-2">
      <div class="col-md-4">
        <label class="form-label">Rank</label>
        <input type="text" class="form-control" id="seaRank">
      </div>
      <div class="col-md-4">
        <label class="form-label">Joined Date</label>
        <input type="date" class="form-control" id="joinedDate">
      </div>
      <div class="col-md-4">
        <label class="form-label">Signed Off Date</label>
        <input type="date" class="form-control" id="signedOffDate">
      </div>
    </div>
    <div class="row mb-2">
      <div class="col-md-6">
        <label class="form-label">Vessel Name</label>
        <input type="text" class="form-control" id="vesselName">
      </div>
      <div class="col-md-6">
        <label class="form-label">Vessel Type</label>
        <input type="text" class="form-control" id="vesselType">
      </div>
    </div>
    <div class="row mb-2">
      <div class="col-md-4">
        <label class="form-label">Engine Type</label>
        <input type="text" class="form-control" id="engineType">
      </div>
      <div class="col-md-4">
        <label class="form-label">GRT</label>
        <input type="number" class="form-control" id="grt">
      </div>
      <div class="col-md-4">
        <label class="form-label">DWT</label>
        <input type="number" class="form-control" id="dwt">
      </div>
    </div>
    <div class="mb-3">
      <label class="form-label">Company / Manager</label>
      <input type="text" class="form-control" id="manager">
    </div>
    <button type="submit" class="btn btn-primary">Save</button>
    <div id="seaMessage" class="text-success mt-2"></div>
  </form>
</div>
<div id="skills">
  <h3>Special Skills</h3>
  <form id="skillsForm" onsubmit="saveSkills(event)">
    <div id="skillsList">
      <div class="row mb-2 skill-item">
        <div class="col-md-5">
          <input type="text" class="form-control" placeholder="Skill (e.g. Dry Docking)" name="skill[]">
        </div>
        <div class="col-md-5">
          <input type="text" class="form-control" placeholder="Remarks" name="remarks[]">
        </div>
        <div class="col-md-2">
          <button type="button" class="btn btn-danger" onclick="removeSkill(this)">Remove</button>
        </div>
      </div>
    </div>
    <button type="button" class="btn btn-secondary mb-3" onclick="addSkill()">+ Add Skill</button><br>
    <button type="submit" class="btn btn-primary">Save</button>
    <div id="skillMessage" class="text-success mt-2"></div>
  </form>
  <div id="experience">
    <h3>Experience</h3>
    <form id="experienceForm" onsubmit="saveExperience(event)">
      <h5>Experience by Vessel Type</h5>
      <div id="vesselExperienceList"></div>
      <h5>Experience by Rank</h5>
      <div id="rankExperienceList"></div>
      <button type="submit" class="btn btn-primary mt-3">Save</button>
      <div id="experienceMessage" class="text-success mt-2"></div>
    </form>
  </div>
    <div id="certificates">
      <h3>Certificates</h3>
      <p>Form for certificates.</p>
    </div>
    <div id="flagbooks">
      <h3>Flag Books</h3>
      <p>Form for flag books.</p>
    </div>
    <div id="licenses">
      <h3>Licenses</h3>
      <p>Form for licenses.</p>
    </div>
    <div id="visas">
      <h3>Visas</h3>
      <p>Form for visas.</p>
    </div>
    <div id="vaccinations">
      <h3>Vaccinations</h3>
      <p>Form for vaccinations.</p>
    </div>
    <div id="education">
      <h3>Education</h3>
      <p>Form for education.</p>
    </div>
    <div id="references">
      <h3>References</h3>
      <p>Form for references.</p>
    </div>
    <div id="finish">
      <h3>Finish</h3>
      <p>Final submission or summary.</p>
    </div>
  </div>

  <script>
    function showTab(id) {
      document.querySelectorAll('.tab-content > div').forEach(div => {
        div.classList.remove('active');
      });
      document.getElementById(id).classList.add('active');

      document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
      });
      event.target.classList.add('active');
    }
  </script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDuF_HlZYG0v7SUaSzILV584J8b5ybnBUU",
    authDomain: "crewapplication-c37a8.firebaseapp.com",
    projectId: "crewapplication-c37a8",
    storageBucket: "crewapplication-c37a8.firebasestorage.app",
    messagingSenderId: "23423243284",
    appId: "1:23423243284:web:67e22f6ed057c74f4b4301"
  };

  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const auth = firebase.auth();

  function savePersonalDetails(event) {
    event.preventDefault();

    const user = auth.currentUser;
    if (!user) {
      alert("You must be logged in to save data.");
      return;
    }

    const data = {
      fullName: document.getElementById("fullName").value,
      dob: document.getElementById("dob").value,
      nationality: document.getElementById("nationality").value,
      birthPlace: document.getElementById("birthPlace").value,
      phone: document.getElementById("phone").value,
      email: document.getElementById("email").value,
      passportNo: document.getElementById("passportNo").value,
      passportIssue: document.getElementById("passportIssue").value,
      passportExpiry: document.getElementById("passportExpiry").value,
      seamanBookNo: document.getElementById("seamanBookNo").value,
      seamanIssue: document.getElementById("seamanIssue").value,
      seamanExpiry: document.getElementById("seamanExpiry").value,
      address: document.getElementById("address").value,
    };

    db.collection("seafarers").doc(user.uid).set({ personalDetails: data }, { merge: true })
      .then(() => {
        document.getElementById("saveMessage").textContent = "Saved successfully!";
      })
      .catch(error => {
        alert("Error saving: " + error.message);
      });
  }

  auth.onAuthStateChanged(user => {
    if (user) {
      const docRef = db.collection("seafarers").doc(user.uid);
      docRef.get().then(doc => {
        if (doc.exists && doc.data().personalDetails) {
          const data = doc.data().personalDetails;
          for (const key in data) {
            if (document.getElementById(key)) {
              document.getElementById(key).value = data[key];
            }
          }
        }
      });
    }
  });
</script>
<script>
  function saveSeaService(event) {
    event.preventDefault();

    const user = auth.currentUser;
    if (!user) {
      alert("You must be logged in to save data.");
      return;
    }

    const seaData = {
      seaRank: document.getElementById("seaRank").value,
      joinedDate: document.getElementById("joinedDate").value,
      signedOffDate: document.getElementById("signedOffDate").value,
      vesselName: document.getElementById("vesselName").value,
      vesselType: document.getElementById("vesselType").value,
      engineType: document.getElementById("engineType").value,
      grt: document.getElementById("grt").value,
      dwt: document.getElementById("dwt").value,
      manager: document.getElementById("manager").value,
    };

    db.collection("seafarers").doc(user.uid).set({ seaService: seaData }, { merge: true })
      .then(() => {
        document.getElementById("seaMessage").textContent = "Sea Service saved!";
      })
      .catch(error => {
        alert("Error saving Sea Service: " + error.message);
      });
  }

  auth.onAuthStateChanged(user => {
    if (user) {
      const docRef = db.collection("seafarers").doc(user.uid);
      docRef.get().then(doc => {
        if (doc.exists && doc.data().seaService) {
          const data = doc.data().seaService;
          for (const key in data) {
            if (document.getElementById(key)) {
              document.getElementById(key).value = data[key];
            }
          }
        }
      });
    }
  });
</script>
<script>
  function addSkill() {
    const skillList = document.getElementById("skillsList");
    const newItem = document.createElement("div");
    newItem.className = "row mb-2 skill-item";
    newItem.innerHTML = `
      <div class="col-md-5">
        <input type="text" class="form-control" placeholder="Skill" name="skill[]">
      </div>
      <div class="col-md-5">
        <input type="text" class="form-control" placeholder="Remarks" name="remarks[]">
      </div>
      <div class="col-md-2">
        <button type="button" class="btn btn-danger" onclick="removeSkill(this)">Remove</button>
      </div>
    `;
    skillList.appendChild(newItem);
  }

  function removeSkill(button) {
    button.closest('.skill-item').remove();
  }

  function saveSkills(event) {
    event.preventDefault();
    const user = auth.currentUser;
    if (!user) {
      alert("You must be logged in to save data.");
      return;
    }

    const skillInputs = document.getElementsByName("skill[]");
    const remarkInputs = document.getElementsByName("remarks[]");
    const skills = [];

    for (let i = 0; i < skillInputs.length; i++) {
      const skill = skillInputs[i].value.trim();
      const remark = remarkInputs[i].value.trim();
      if (skill !== "") {
        skills.push({ skill, remark });
      }
    }

    db.collection("seafarers").doc(user.uid).set({ specialSkills: skills }, { merge: true })
      .then(() => {
        document.getElementById("skillMessage").textContent = "Skills saved!";
      })
      .catch(error => {
        alert("Error saving skills: " + error.message);
      });
  }

  auth.onAuthStateChanged(user => {
    if (user) {
      const docRef = db.collection("seafarers").doc(user.uid);
      docRef.get().then(doc => {
        if (doc.exists && doc.data().specialSkills) {
          const data = doc.data().specialSkills;
          const skillList = document.getElementById("skillsList");
          skillList.innerHTML = ""; // temizle

          data.forEach(item => {
            const newItem = document.createElement("div");
            newItem.className = "row mb-2 skill-item";
            newItem.innerHTML = `
              <div class="col-md-5">
                <input type="text" class="form-control" placeholder="Skill" name="skill[]" value="${item.skill}">
              </div>
              <div class="col-md-5">
                <input type="text" class="form-control" placeholder="Remarks" name="remarks[]" value="${item.remark}">
              </div>
              <div class="col-md-2">
                <button type="button" class="btn btn-danger" onclick="removeSkill(this)">Remove</button>
              </div>
            `;
            skillList.appendChild(newItem);
          });
        }
      });
    }
  });
</script>
<script>
  function addSeaServiceEntry() {
    const container = document.getElementById("seaServiceList");
    const index = container.children.length;

    const entry = document.createElement("div");
    entry.className = "border p-3 mb-3";
    entry.innerHTML = `
      <div class="row mb-2">
        <div class="col-md-4">
          <label class="form-label">Rank</label>
          <input type="text" class="form-control" name="rank[]">
        </div>
        <div class="col-md-4">
          <label class="form-label">Joined Date</label>
          <input type="date" class="form-control" name="joinedDate[]">
        </div>
        <div class="col-md-4">
          <label class="form-label">Signed Off Date</label>
          <input type="date" class="form-control" name="signedOffDate[]">
        </div>
      </div>
      <div class="row mb-2">
        <div class="col-md-6">
          <label class="form-label">Vessel Name</label>
          <input type="text" class="form-control" name="vesselName[]">
        </div>
        <div class="col-md-6">
          <label class="form-label">Vessel Type</label>
          <input type="text" class="form-control" name="vesselType[]">
        </div>
      </div>
      <div class="row mb-2">
        <div class="col-md-4">
          <label class="form-label">Engine Type</label>
          <input type="text" class="form-control" name="engineType[]">
        </div>
        <div class="col-md-4">
          <label class="form-label">GRT</label>
          <input type="number" class="form-control" name="grt[]">
        </div>
        <div class="col-md-4">
          <label class="form-label">DWT</label>
          <input type="number" class="form-control" name="dwt[]">
        </div>
      </div>
      <div class="mb-2">
        <label class="form-label">Company / Manager</label>
        <input type="text" class="form-control" name="manager[]">
      </div>
      <button type="button" class="btn btn-danger btn-sm" onclick="this.parentElement.remove()">Remove Entry</button>
    `;
    container.appendChild(entry);
  }

  // Sayfa açılırken 1 satır gösterelim
  document.addEventListener("DOMContentLoaded", () => {
    addSeaServiceEntry();
  });
</script>
<script>
  function saveSeaService(event) {
    event.preventDefault();
    const user = auth.currentUser;
    if (!user) {
      alert("You must be logged in.");
      return;
    }

    const ranks = document.getElementsByName("rank[]");
    const joinedDates = document.getElementsByName("joinedDate[]");
    const signedOffDates = document.getElementsByName("signedOffDate[]");
    const vesselNames = document.getElementsByName("vesselName[]");
    const vesselTypes = document.getElementsByName("vesselType[]");
    const engineTypes = document.getElementsByName("engineType[]");
    const grts = document.getElementsByName("grt[]");
    const dwts = document.getElementsByName("dwt[]");
    const managers = document.getElementsByName("manager[]");

    const records = [];

    for (let i = 0; i < ranks.length; i++) {
      const rank = ranks[i].value.trim();
      const joinedDate = joinedDates[i].value;
      const signedOffDate = signedOffDates[i].value;
      const vesselName = vesselNames[i].value.trim();
      const vesselType = vesselTypes[i].value.trim();
      const engineType = engineTypes[i].value.trim();
      const grt = grts[i].value;
      const dwt = dwts[i].value;
      const manager = managers[i].value.trim();

      if (rank && joinedDate && signedOffDate && vesselName) {
        records.push({
          rank,
          joinedDate,
          signedOffDate,
          vesselName,
          vesselType,
          engineType,
          grt,
          dwt,
          manager
        });
      }
    }

    db.collection("seafarers").doc(user.uid).set({ seaServiceRecords: records }, { merge: true })
      .then(() => {
        document.getElementById("seaMessage").textContent = "Sea Service records saved!";
      })
      .catch(error => {
        alert("Error saving sea service records: " + error.message);
      });
  }
</script>
<script>
  auth.onAuthStateChanged(user => {
    if (user) {
      const docRef = db.collection("seafarers").doc(user.uid);
      docRef.get().then(doc => {
        if (doc.exists && doc.data().seaServiceRecords) {
          const records = doc.data().seaServiceRecords;
          const container = document.getElementById("seaServiceList");
          container.innerHTML = ""; // Temizle

          records.forEach(record => {
            const entry = document.createElement("div");
            entry.className = "border p-3 mb-3";
            entry.innerHTML = `
              <div class="row mb-2">
                <div class="col-md-4">
                  <label class="form-label">Rank</label>
                  <input type="text" class="form-control" name="rank[]" value="${record.rank || ''}">
                </div>
                <div class="col-md-4">
                  <label class="form-label">Joined Date</label>
                  <input type="date" class="form-control" name="joinedDate[]" value="${record.joinedDate || ''}">
                </div>
                <div class="col-md-4">
                  <label class="form-label">Signed Off Date</label>
                  <input type="date" class="form-control" name="signedOffDate[]" value="${record.signedOffDate || ''}">
                </div>
              </div>
              <div class="row mb-2">
                <div class="col-md-6">
                  <label class="form-label">Vessel Name</label>
                  <input type="text" class="form-control" name="vesselName[]" value="${record.vesselName || ''}">
                </div>
                <div class="col-md-6">
                  <label class="form-label">Vessel Type</label>
                  <input type="text" class="form-control" name="vesselType[]" value="${record.vesselType || ''}">
                </div>
              </div>
              <div class="row mb-2">
                <div class="col-md-4">
                  <label class="form-label">Engine Type</label>
                  <input type="text" class="form-control" name="engineType[]" value="${record.engineType || ''}">
                </div>
                <div class="col-md-4">
                  <label class="form-label">GRT</label>
                  <input type="number" class="form-control" name="grt[]" value="${record.grt || ''}">
                </div>
                <div class="col-md-4">
                  <label class="form-label">DWT</label>
                  <input type="number" class="form-control" name="dwt[]" value="${record.dwt || ''}">
                </div>
              </div>
              <div class="mb-2">
                <label class="form-label">Company / Manager</label>
                <input type="text" class="form-control" name="manager[]" value="${record.manager || ''}">
              </div>
              <button type="button" class="btn btn-danger btn-sm" onclick="this.parentElement.remove()">Remove Entry</button>
            `;
            container.appendChild(entry);
          });
        }
      });
    }
  });
</script>
</body>
</html>