<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Verified Sea Service Summary</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="/style.css"/>
  <style>@media(max-width:768px){ .table{font-size:.9rem} }</style>
</head>
<body class="bg-light p-4">
  <div class="container">
    <h3 class="mb-3 text-center">Verified Sea Service Summary</h3>
    <div class="table-responsive">
      <table class="table table-bordered table-striped align-middle">
        <thead class="table-primary text-center">
          <tr><th>Vessel</th><th>IMO</th><th>Type</th><th>Rank</th><th>GRT</th><th>Start</th><th>End</th><th>Days</th></tr>
        </thead>
        <tbody id="tbody"></tbody>
        <tfoot><tr class="fw-bold text-center"><td colspan="7">Total Experience</td><td id="totalDays"></td></tr></tfoot>
      </table>
    </div>
  </div>

  <script type="module">
    if ((localStorage.getItem('role')||'').toLowerCase()!=='seafarer') window.top.location.href='/index.html';

    import { auth, db } from '/firebase-config.js';
    import { collection, getDocs } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';
    import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';

    const tbody=document.getElementById('tbody'); const totalEl=document.getElementById('totalDays');

    const days=(a,b)=>{ const d=(new Date(b))-(new Date(a)); return Math.floor(d/86400000); };
    const pretty=(n)=>{ const y=Math.floor(n/365); const m=Math.floor((n%365)/30); const d=n%30; return `${y}y ${m}m ${d}d`; };

    onAuthStateChanged(auth, async user=>{
      if(!user) return window.location.href='/index.html';
      const snap=await getDocs(collection(db,`seafarers/${user.uid}/seaService`));
      let total=0;
      snap.forEach(s=>{
        const d=s.data(); if(!d.isVerified) return;
        const day=days(d.start,d.end); total+=day;
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${d.vessel||''}</td><td>${d.imo||'-'}</td><td>${d.type||'-'}</td><td>${d.rank||'-'}</td><td>${d.grt||'-'}</td><td>${d.start||''}</td><td>${d.end||''}</td><td class="text-center">${day}</td>`;
        tbody.appendChild(tr);
      });
      totalEl.textContent = pretty(total);
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
