<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Qualifications</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="../../style.css"/>
  <style>
    @media (max-width:768px){ .form-label,.form-control,.form-select{font-size:.95rem} .section-title{font-size:1.25rem;text-align:center} }
    .form-box{max-width:520px;margin:28px auto;background:#fff;border-radius:14px;box-shadow:0 1px 12px #e5e7ee;padding:26px}
  </style>
</head>
<body class="bg-light p-4">
  <div class="container">
    <form id="qualForm" class="form-box">
      <div class="section-title h5 mb-3">Qualifications</div>
      <div class="mb-3"><label class="form-label">Rank Applied</label><select id="rankApplied" class="form-select"></select></div>
      <div class="mb-3"><label class="form-label">Lowest Rank Acceptable</label><select id="lowestRank" class="form-select"></select></div>
      <div class="mb-3"><label class="form-label">Preferred Vessel Type</label><select id="vesselType" class="form-select"></select></div>
      <div class="mb-3"><label class="form-label">Readiness Date</label><input id="readiness" type="date" class="form-control"></div>
      <div class="text-end"><button class="btn btn-primary">Save</button></div>
    </form>
  </div>

  <!-- Toast -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index:11">
    <div id="toastMsg" class="toast text-bg-primary border-0" role="alert"><div class="d-flex"><div class="toast-body" id="toastBody">Saved</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button></div></div>
  </div>

  <script type="module">
    if ((localStorage.getItem('role')||'').toLowerCase()!=='seafarer') window.top.location.href='../../index.html';

    // Options
    const setOpts = async (id, file)=>document.getElementById(id).innerHTML = await fetch(file).then(r=>r.text());
    await setOpts('rankApplied','../../options/options-ranks.html');
    await setOpts('lowestRank','../../options/options-ranks.html');
    await setOpts('vesselType','../../options/options-vessels.html');

    import { auth, db } from '../../firebase-config.js';
    import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
    import { doc, getDoc, setDoc } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

    const toast = new bootstrap.Toast(document.getElementById('toastMsg')); const tBody=document.getElementById('toastBody');
    const form=document.getElementById('qualForm');

    onAuthStateChanged(auth, async (user)=>{
      if(!user) return;
      const ref=doc(db,'seafarers',user.uid,'cv','qualifications');
      const snap=await getDoc(ref);
      if(snap.exists()){
        const d=snap.data();
        form.rankApplied.value=d.rankApplied||''; form.lowestRank.value=d.lowestRank||'';
        form.vesselType.value=d.vesselType||''; form.readiness.value=d.readiness||'';
      }
      form.addEventListener('submit', async e=>{
        e.preventDefault();
        await setDoc(ref,{
          rankApplied:form.rankApplied.value,
          lowestRank:form.lowestRank.value,
          vesselType:form.vesselType.value,
          readiness:form.readiness.value
        });
        tBody.textContent='Saved âœ…'; toast.show();
      });
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
