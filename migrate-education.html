<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8" />
<title>Migrate education → cv/education/items</title>
<body style="font-family:system-ui;padding:24px">
<h3>Migrating education…</h3>
<pre id="log">Starting…</pre>

<script type="module">
import { auth, db } from '/firebase-config.js';
import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
import {
  collection, getDocs, doc, setDoc, deleteDoc
} from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

const log = (...a)=>document.getElementById('log').textContent += '\n' + a.join(' ');

onAuthStateChanged(auth, async (user)=>{
  if(!user){ log('Please sign in first.'); return; }

  const oldCol = collection(db, `seafarers/${user.uid}/education`);
  const snap   = await getDocs(oldCol);
  if (snap.empty){ log('No documents at seafarers/{uid}/education — nothing to migrate.'); return; }

  let moved=0;
  for (const d of snap.docs){
    const data = d.data();
    const newRef = doc(db, `seafarers/${user.uid}/cv/education/items/${d.id}`);
    await setDoc(newRef, data, { merge:true });
    await deleteDoc(d.ref);
    moved++;
    log('Moved:', d.id);
  }
  log(`Done. Moved ${moved} document(s).`);
});
</script>
</body>
</html>
